# CodeQL Configuration for Terraform ARC Cluster
# This configuration file defines how CodeQL analyzes the repository for security vulnerabilities

name: "Terraform ARC Cluster CodeQL Config"

# Disable default queries to use custom query selections
disable-default-queries: false

# Query packs to include in analysis
packs:
  # Security and quality queries for JavaScript/TypeScript (for YAML/JSON configs)
  javascript:
    - "codeql/javascript-queries:Security"
    - "codeql/javascript-queries:AlertSuppression"
    
  # Add Python queries if any Python scripts are present
  python:
    - "codeql/python-queries:Security"
    - "codeql/python-queries:AlertSuppression"

# Additional queries to run beyond the default set
queries:
  # Security-focused queries
  - name: security-extended
    uses: security-extended
  - name: security-and-quality  
    uses: security-and-quality

# Paths to include in analysis
paths:
  - ".github/**"
  - "terraform/**"
  - "docs/**"
  - "*.md"
  - "*.yml"
  - "*.yaml"
  - "*.json"

# Paths to exclude from analysis
paths-ignore:
  - "**/node_modules/**"
  - "**/vendor/**"
  - "**/.terraform/**"
  - "**/terraform.tfstate*"
  - "**/.git/**"
  - "**/build/**"
  - "**/dist/**"
  - "**/coverage/**"
  - "**/__pycache__/**"
  - "**/*.min.js"
  - "**/*.min.css"
  - "**/LICENSE*"
  - "**/.terraform.lock.hcl"

# Configuration for different languages
javascript:
  # Include TypeScript files if any
  index:
    - "**/*.js"
    - "**/*.ts"
    - "**/*.jsx"
    - "**/*.tsx"
    - "**/*.mjs"
    - "**/*.vue"
    - "**/*.json"
    - "**/*.yml"
    - "**/*.yaml"
  
  # Extraction configuration
  extraction:
    # Include YAML files for GitHub Actions analysis
    yaml:
      extensions:
        - "yml"
        - "yaml"

python:
  # Python file patterns (if any Python scripts are added)
  index:
    - "**/*.py"
    - "**/*.pyx"
    - "**/*.pyi"

# Analysis configuration
analysis:
  # Set timeout for analysis (in minutes)
  timeout: 30
  
  # Memory limit for analysis (in MB)
  ram: 4096
  
  # Number of threads to use
  threads: 0  # Use all available threads

# Custom query suites
query-suites:
  - name: "Infrastructure Security"
    description: "Security queries specifically for infrastructure code"
    queries:
      - "javascript/security/client-side-url-redirect"
      - "javascript/security/code-injection"
      - "javascript/security/command-line-injection"
      - "javascript/security/hard-coded-credentials"
      - "javascript/security/insufficient-key-size"
      - "javascript/security/missing-origin-check"
      - "javascript/security/prototype-pollution"
      - "javascript/security/regex-injection"
      - "javascript/security/shell-command-constructed-from-input"
      - "javascript/security/unsafe-deserialization"
      - "javascript/security/xpath-injection"

# Alert filtering and categorization
alerts:
  # Rules for categorizing alerts
  rules:
    - id: "high-severity-security"
      severity: "error"
      security-severity: "high"
      tags: ["security", "high-risk"]
      
    - id: "medium-severity-security"
      severity: "warning"  
      security-severity: "medium"
      tags: ["security", "medium-risk"]
      
    - id: "low-severity-security"
      severity: "note"
      security-severity: "low"
      tags: ["security", "low-risk"]

# Sarif output configuration
sarif:
  # Include supplementary information
  add-snippets: true
  
  # Include categories for better organization
  category-prefix: "terraform-arc"